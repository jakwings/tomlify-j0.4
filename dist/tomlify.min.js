(function(){function w(a,c,b){if(null==a)throw Error("Undefined or null cannot be stringified.");if(H(a))throw Error("Converting circular structure to TOML.");c="function"===typeof c?c:null;b=D(b);if(!q(a))return E(a,c,b);var d=[];y({path:[],table:{"":a},c:!1,b:!1,replace:c,level:0,a:b,f:d},"",a,function(a,b,c){if(q(c))""!==b&&(0<d.length&&d.push(""),b=a.b?"[["+z(a.path,!0)+"]]":"["+z(a.path,!0)+"]",d.push(r(b,a.level,a.a)));else if(t(c))if(k(b))x(c)||(b=C(a,b,c),k(b)&&d.push(r(b,a.level,a.a)));else return!0;
else return k(b)&&(b=C(a,b,c),k(b)&&d.push(r(b,a.level,a.a))),!0});return d.join("\n")}function D(a){return k(a)?a:"number"===typeof a&&0<=a&&isFinite(a)&&Math.floor(a)===a?F(" ",a):""}function r(a,c,b){c=F(b,c);return a.replace(/^(?!$)/mg,c)}function F(a,c){if(a.repeat)return a.repeat(c);for(var b="",d="";0<c;)d+=d||a,c&1&&(b+=d),c>>>=1;return b}function y(a,c,b,d){var f;if(a.replace&&0===a.path.length&&(f=A(a,c,b),k(f)&&a.f.push(f),!1!==f))return;if(!d(a,c,b)){c=a.table;a.table=b;if(t(b)){var g=
a.b;a.b=x(b);for(var e=0,m=b.length;e<m;e++)a.path.push(e),y(a,e,b[e],d),a.path.pop();a.b=g}else if(q(b)){g=a.b;a.b=!1;var p=[],l=[],h;for(h in b)Object.prototype.hasOwnProperty.call(b,h)&&(f=b[h],e=0<a.path.length&&(t(f)?x(f):q(f)),t(f)&&x(f)?l.push(h,f,e):q(f)?p.push(h,f,e):(a.path.push(h),y(a,h,f,d),a.path.pop()));if(a.replace){e=0;for(m=p.length;e<m;e+=3)a.path.push(p[e]),f=A(a,p[e],p[e+1]),k(f)?(a.f.push(r(f,a.level,a.a)),p[e+1]=null):null==f&&(p[e+1]=null),a.path.pop();e=0;for(m=l.length;e<
m;e+=3){a.path.push(l[e]);f=A(a,l[e],l[e+1]);if(k(f))f=v(l[e])+" = "+f,a.f.push(r(f,a.level,a.a));else if(null==f){l[e+1]=null;a.path.pop();continue}b=0;for(h=l[e+1].length;b<h;b++)if(a.path.push(b),f=A(a,b,l[e+1][b]),a.path.pop(),null==f)l[e+1][b]=null;else if(!1!==f){f=C(a,l[e],l[e+1]);k(f)&&a.f.push(r(f,a.level,a.a));l[e+1]=null;break}a.path.pop()}}h=p.concat(l);e=0;for(m=h.length;e<m;e+=3)null!=h[e+1]&&(a.path.push(h[e]),h[e+2]&&a.level++,y(a,h[e],h[e+1],d),h[e+2]&&a.level--,a.path.pop());a.b=
g}a.table=c}}function A(a,c,b){if(a.replace){b=a.replace.call({path:a.path.slice(0),table:a.table},c,b);if(k(b))return v(c)+" = "+b;if(null==b)return null;if(!1!==b)throw Error(u(a.path,"Replacer must return a string, false, null or undefined."));}return!1}function C(a,c,b){var d=v(c);if(!d)throw Error(u(a.path,"Key cannot be an empty string."));a=B(a,c,b);return k(a)?d+" = "+a:null}function v(a){return a?/^[a-zA-Z0-9\-_]+$/.test(a)?a:G(a):!1}function E(a,c,b){if(null==a)throw Error("Undefined or null cannot be stringified.");
return B({path:[],table:{"":a},b:!1,replace:"function"===typeof c?c:null,level:0,a:D(b)},"",a)}function B(a,c,b){if(a.replace){c=a.replace.call({path:a.path.slice(0),table:a.table},c,b);if(k(c))return c;if(null==c)return null;if(!1!==c)throw Error(u(a.path,"Replacer must return a string, false, null or undefined."));}switch(g(b)){case g.Boolean:return b?"true":"false";case g.String:return G(b);case g.Number:if(!isFinite(b))throw Error(u(a.path,"Number must be finite."));a=(Number.isInteger?Number.isInteger(b):
Math.floor(b)===b)?b.toFixed(1):String(b);a=a.replace(/([eE])(\d)/,"$1+$2");return/[.eE]/.test(a)?a:a+".0";case g.Array:var d;a:{if(!(2>b.length)){d=g(b[0]);c=1;for(var f=b.length;c<f;c++)if(null!=b[c]&&g(b[c])!==d){d=!0;break a}}d=!1}if(d)throw Error(u(a.path,"Array cannot contain values of different types."));d=a.table;a.table=b;c=[];f=a.c;x(b)&&(a.c=!0);for(var n=0,e=b.length;n<e;n++){a.path.push(n);var m=B(a,n,b[n]);k(m)&&c.push(m);a.path.pop()}a.c=f;a.table=d;return!a.c&&0<c.length&&a.a?"[\n"+
r(c.join(",\n"),1,a.a)+"\n]":"["+c.join(", ")+"]";case g.Date:if(!isFinite(b.getTime()))throw Error(u(a.path,"Invalid Date"));return b.toISOString();default:if(null==b)a=null;else{c=a.table;a.table=b;f=a.c;a.c=!0;n=[];for(d in b)if(Object.prototype.hasOwnProperty.call(b,d)&&null!=b[d]){if(!d)throw Error(u(a.path,"Key cannot be an empty string."));a.path.push(d);e=B(a,d,b[d]);k(e)&&n.push(v(d)+" = "+e);a.path.pop()}a.c=f;a.table=c;a="{"+n.join(", ")+"}"}return a}}function G(a){return"object"===typeof JSON&&
JSON?JSON.stringify(a):'"'+String(a).replace(/[\x00-\x1F"\\]/g,function(a){switch(a){case '"':case "\\":return"\\"+a;case "\t":return"\\t";case "\n":return"\\n";case "\r":return"\\r";case "\b":return"\\b";case "\f":return"\\f";default:return a=a.charCodeAt(0).toString(16),"\\u"+"0000".substr(a.length)+a}})+'"'}function H(a){function c(a,d){if(!t(a)&&!q(a))return!1;if(-1!==d.indexOf(a))return!0;d.push(a);for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b)){var g=d.length;if(c(a[b],d))return!0;
d.splice(g)}return!1}return c(a,[])}function x(a){if(1>a.length)return!1;for(var c=0,b=a.length;c<b;c++)if(q(a[c]))return!0;return!1}function q(a){return null!==a&&"object"===typeof a&&!(t(a)||g(a)===g.Date)}function k(a){return"string"===typeof a}function g(a){return Object.prototype.toString.call(a)}function u(a,c){return(z(a)||"<root>")+": "+c}function z(a,c){if(0===a.length)return"";for(var b="",d=0,f=a.length;d<f;d++)if(k(a[d])&&a[d])b+=(b?".":"")+v(a[d]);else if("number"===typeof a[d])c||(b+=
(b?".":"")+"["+a[d]+"]");else return!1;return b?b:!1}g.Boolean=g(!1);g.String=g("");g.Number=g(0);g.Array=g([]);g.Date=g(new Date(0));var t=Array.isArray||function(a){return g(a)===g.Array};w.toKey=function(a,c){if(k(a)){var b=v(a);if(!b)throw Error("Key cannot be an empty string.");return b}if(t(a)){b=z(a,c);if(!1===b)throw Error("Key path must consist of non-empty string(s).");return b}throw Error("Invalid Arguments for tomlify.toKey({String | Array})");};w.toValue=E;null!=("undefined"!==typeof module&&
null!==module?module.exports:void 0)?module.exports=w:"function"===typeof define&&define.amd?define([],function(){return w}):this.tomlify=w}).call(this);
